<html>
  <head>
    <link rel="stylesheet" href="codemirror-repl.css"/>
    <script src="codemirror-repl.js"></script>
  </head>
  <body>
    <textarea id="repl" autofocus="true"></textarea>
  </body>
    <script language="javascript" src="all.js"></script>

    <script language="javascript">
// Setup the repl.
var repl = new CodeMirrorREPL("repl", {
    mode: "javascript",
    theme: "eclipse"
});

function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

async function eval_fn(expr) {
    var tmp = {"arg": expr};
    try {
        eval_fn_(tmp);
        if (typeof tmp.result === "undefined") {
            console.log("sleeping in the hope this is an async call");
            await sleep(1000);
        }
        repl.print(tmp.result);
    } catch (error) {
        console.log(error);
        repl.print(error, "error");
    }
}
repl.eval = eval_fn

</script>
</html>
