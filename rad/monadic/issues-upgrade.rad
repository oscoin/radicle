(load! "rad/monadic/issues.rad")

(import prelude/machine :unqualified)

;; This is a script that migrates the issues machine. It is used when there is a
;; breaking change.
;; Example:
;; (migrate-issues! "machines.radicle.xyz/machines/radicle-issues"
;;                  "machines.radicle.xyz/machines/new-radicle-issues")

(def input-pat
  (list (/member ['create-issue 'edit-issue 'add-comment 'edit-comment]) _))

(def input?
  (fn [i]
    (match i
           input-pat #t
           _         #f)))

(def migrate-issues!
  (fn [old new]
    (def is (nth 1 (receive! old :nothing)))
    (create-issues-machine! new)
    (send! new (filter input? is))))
